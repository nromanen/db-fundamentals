Show the list of customers’ names who used to order the ‘Tofu’ product (use a subquery).

select c.contact_name 
from customers c 
where c.customer_id = any (
select o.customer_id 
from orders o 	
where o.order_id = any (
select od.order_id 
from order_details od 
where od.product_id = any (
select p.product_id 
from products p 
where p.product_name = 'Tofu'
)
)
)

Show the list of customers’ names who used to order the ‘Tofu’ product, along with the total amount of the product they have ordered and with the total sum for ordered product calculated.

select c.contact_name 
, sum(od.quantity) as Amount
, round(sum(od.quantity*od.unit_price*(1-od.discount))::numeric ,2) 
from customers c 
inner join orders o on o.customer_id = c.customer_id 
inner join order_details od on od.order_id = o.order_id 
inner join products p on p.product_id = od.product_id 
where p.product_name = 'Tofu'
group by c.contact_name
order by 1

Show the list of french customers’ names who used to order non-french products (use a subquery).

select c.contact_name 
from customers c 
where c.country like 'France' and c.customer_id = any (
select o.customer_id  
from orders o 
where o.order_id = any  (
select od.order_id  
from order_details od
where od.product_id = any  (
select p.product_id 
from products p 
where p.supplier_id = any  (
select s.supplier_id 
from suppliers s 
where s.country not like 'France'
)
)
)
)

Show the total ordering sums calculated for each customer’s country for domestic and non-domestic products separately (e.g.: “France – French products ordered – Non-french products ordered” and so on for each country).

select o.ship_country 
, round(sum( case when c.country like s.country then od.unit_price*od.quantity*(1-od.discount) else 0 end)::numeric ,2) as Domestic
, round(sum( case when c.country not like s.country then od.unit_price*od.quantity*(1-od.discount) else 0 end)::numeric ,2) as "Non-domestic"
from orders o  
left join order_details od on o.order_id = od.order_id 
left join products p on p.product_id = od.product_id 
left join customers c on c.customer_id = o.customer_id 
left join suppliers s on s.supplier_id = p.supplier_id  
group by o.ship_country 
order by o.ship_country 
