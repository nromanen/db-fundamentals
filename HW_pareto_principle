select count(b.*) as "Count of companies",
 b.cat as "% of revenue"
from (select a.company_name, a.orders_sum,
(a.orders_sum/
(select sum(od.unit_price * od.quantity * (1 - od.discount)) from order_details od) * 100) :: Numeric(18,2) ||'%' as part_of_profit
,SUM((a.orders_sum/(select sum(od.unit_price * od.quantity * (1 - od.discount)) from order_details od) * 100) :: Numeric(18,2))
over (ORDER by a.orders_sum desc) ||'%' as cumulative_sum
,case 
	when SUM((a.orders_sum/(select sum(od.unit_price * od.quantity * (1 - od.discount)) from order_details od) * 100) :: Numeric(18,2))
over (ORDER by a.orders_sum desc) <= 81 then '80% from revenue'
	when SUM((a.orders_sum/(select sum(od.unit_price * od.quantity * (1 - od.discount)) from order_details od) * 100) :: Numeric(18,2))
over (ORDER by a.orders_sum desc) > 81 then 'other 20%'
end as cat
from 
(select c.company_name as company_name,
sum(od.unit_price * od.quantity  * (1- od.discount)) ::numeric(18,2) as orders_sum
from customers c 
join orders o on c.customer_id = o.customer_id 
join order_details od on od.order_id = o.order_id 
group by c.company_name 
order by sum(od.unit_price * od.quantity  * (1- od.discount)) ::numeric(18,2) desc) as a
order by orders_sum desc) as b
group by b.cat
